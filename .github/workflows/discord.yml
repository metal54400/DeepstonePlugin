name: Annonce update plugin

on:
  release:
    types: [published]

jobs:
  announce:
    runs-on: ubuntu-latest
    steps:
      - name: Envoyer l'annonce Discord
        run: |
          WEBHOOK_URL="https://discord.com/api/webhooks/1470481645449510946/46pIUNdqayUcEzrANvUyFhyuWXuJaetAfywveyr1mTScLOF762-oWoe3Ye-tk40GCihO"

          VERSION="${{ github.event.release.tag_name }}"
          URL="${{ github.event.release.html_url }}"
          CHANGELOG="${{ github.event.release.body }}"

          # Si le changelog est vide, √©vite un message moche
          if [ -z "$CHANGELOG" ]; then
            CHANGELOG="(pas de d√©tails)"
          fi

          PAYLOAD=$(jq -n --arg content "üì¢ **Nouvelle mise √† jour du plugin DeepstonePlugin**\n\nüß© Version : $VERSION\nüìù Changelog :\n$CHANGELOG\n\nüîó $URL" '{content: $content}')

          curl -H "Content-Type: application/json" \
               -d "$PAYLOAD" \
               "$WEBHOOK_URL"
